DROP TABLE IF EXISTS users CASCADE;
DROP TABLE IF EXISTS categories CASCADE;
DROP TABLE IF EXISTS locations CASCADE;
DROP TABLE IF EXISTS events CASCADE;
DROP TABLE IF EXISTS compilations CASCADE;
DROP TABLE IF EXISTS compilations_events CASCADE;
DROP TABLE IF EXISTS requests CASCADE;

CREATE TABLE if NOT EXISTS USERS
(
ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
NAME VARCHAR(255) NOT NULL,
EMAIL VARCHAR(255) NOT NULL UNIQUE,
CONSTRAINT PK_USER
PRIMARY KEY (ID)
);


CREATE TABLE if NOT EXISTS categories
(
ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
NAME VARCHAR(255) NOT NULL,
CONSTRAINT PK_CATEGORY
PRIMARY KEY (ID)
);

CREATE TABLE if NOT EXISTS locations
(
ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
lat FLOAT NOT NULL,
lon FLOAT NOT NULL,
CONSTRAINT PK_LOCATION
PRIMARY KEY (ID)
);



CREATE TABLE if NOT EXISTS events
(
ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
annotation VARCHAR,
category_id BIGINT,
confirmed_Requests BIGINT,
description TEXT,
event_Date TIMESTAMP WITHOUT TIME ZONE,
created_On TIMESTAMP WITHOUT TIME ZONE,
initiator_id BIGINT,
location_id BIGINT,
paid  BOOLEAN,
participant_Limit BIGINT,
published_On TIMESTAMP WITHOUT TIME ZONE,
request_Moderation BOOLEAN,
state VARCHAR,
title VARCHAR,
views BIGINT,
CONSTRAINT PK_EVENT
PRIMARY KEY (ID),
CONSTRAINT EVENTS_CATEGORIES_ID_FK
FOREIGN KEY (category_id) REFERENCES categories (ID) ON DELETE CASCADE,
CONSTRAINT EVENTS_LOCATIONS_ID_FK
FOREIGN KEY (location_id) REFERENCES locations (ID) ON DELETE CASCADE,
CONSTRAINT EVENTS_USERS_ID_FK
FOREIGN KEY (initiator_id) REFERENCES USERS (ID) ON DELETE CASCADE
);


CREATE TABLE if NOT EXISTS Requests
(
ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
created TIMESTAMP WITHOUT TIME ZONE,
event BIGINT NOT NULL,
requester BIGINT NOT NULL,
status VARCHAR NOT NULL,
CONSTRAINT PK_REQUEST
PRIMARY KEY (ID),
CONSTRAINT REQUESTS_EVENTS_ID_FK
FOREIGN KEY (event) REFERENCES EVENTS (ID) ON DELETE CASCADE,
CONSTRAINT REQUESTS_USERS_ID_FK
FOREIGN KEY (requester) REFERENCES USERS (ID) ON DELETE CASCADE
);


CREATE TABLE IF NOT EXISTS compilations
(
id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
pinned BOOLEAN,
title  VARCHAR,
CONSTRAINT uq_compilation_title UNIQUE (title)
);

CREATE TABLE IF NOT EXISTS compilations_events
(
event_id BIGINT,
compilation_id BIGINT,
CONSTRAINT fk_to_compilations
FOREIGN KEY (compilation_id) REFERENCES compilations (id),
CONSTRAINT fk_to_events
FOREIGN KEY (event_id) REFERENCES events (id)
);

